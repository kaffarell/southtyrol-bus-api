{"code":"import request from 'request';\r\nimport * as xml2js from 'xml2js';\r\nfunction extractDataFromXML(res, returnBody) {\r\n    var parser = new xml2js.Parser();\r\n    parser.parseString(returnBody, function (err, data) {\r\n        if (err) {\r\n            res.end(err);\r\n            res.sendStatus(500);\r\n        }\r\n        else {\r\n            var usefulResponse = data.itdRequest.itdStopFinderRequest[0].itdOdv;\r\n            var stopFinderRequestArray = [];\r\n            for (var i = 0; i < usefulResponse[0].itdOdvAssignedStops[0].itdOdvAssignedStop.length; i++) {\r\n                var newStopFinderRequest = {\r\n                    nearestStopName: usefulResponse[0].itdOdvAssignedStops[0].itdOdvAssignedStop[i].$.nameWithPlace,\r\n                    nearestStopId: usefulResponse[0].itdOdvAssignedStops[0].itdOdvAssignedStop[i].$.stopId,\r\n                    nearestStopPlace: usefulResponse[0].itdOdvAssignedStops[0].itdOdvAssignedStop[i].$.place,\r\n                    nearestStopDistance: usefulResponse[0].itdOdvAssignedStops[0].itdOdvAssignedStop[i].$.distance,\r\n                    nearestStopDistanceTime: usefulResponse[0].itdOdvAssignedStops[0].itdOdvAssignedStop[i].$.distanceTime,\r\n                    nearestPlace: usefulResponse[0].itdOdvPlace[0].odvPlaceElem[0]._,\r\n                    nearestStreet: usefulResponse[0].itdOdvName[0].odvNameElem[0]._,\r\n                };\r\n                stopFinderRequestArray.push(newStopFinderRequest);\r\n            }\r\n            res.json(stopFinderRequestArray);\r\n        }\r\n    });\r\n}\r\nfunction findLocationAction(req, res) {\r\n    var longitude = req.body.lon;\r\n    var latitude = req.body.lat;\r\n    var returnBody;\r\n    request('http://efa.sta.bz.it/apb/XML_STOPFINDER_REQUEST?locationServerActive=0&type_sf=coord&name_sf=' + longitude + ':' + latitude + ':WGS84[DD.DDDDD]', function (reqErr, reqRes, reqBody) {\r\n        if (reqErr) {\r\n            res.sendStatus(500);\r\n            res.end(reqErr);\r\n        }\r\n        else {\r\n            returnBody = reqBody;\r\n            extractDataFromXML(res, returnBody);\r\n        }\r\n    });\r\n}\r\nexport default findLocationAction;\r\n","references":["/home/gabriel/Desktop/programming/southtyrol-mobile/southtyrol-bus-api/node_modules/@types/request/index.d.ts","/home/gabriel/Desktop/programming/southtyrol-mobile/southtyrol-bus-api/node_modules/@types/express/index.d.ts","/home/gabriel/Desktop/programming/southtyrol-mobile/southtyrol-bus-api/node_modules/@types/xml2js/index.d.ts"]}
